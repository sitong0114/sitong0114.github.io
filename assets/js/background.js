const code = "011 0 011110 010 0   10 111   000 1 010 01 10 110 0 010 000   1 111   0100 111 0001 0   1011 111 001   101 10 111 011   1 0000 0   010 001 0100 0 000   01 10 100   000 111   100 111   00   01   0010 001 0100 0100   1010 111 11 11 00 1 11 0 10 1 011110 000   011 0000 01 1   00 011110 11   1 0000 00 10 101 00 10 110   111 0010   1011 111 001   011 111 001 0100 100 10 011110 1   110 0 1   1 0000 00 000   0010 010 111 11   01 10 1011   111 1 0000 0 010   110 001 1011   00   0111 001 000 1   011 01 10 10 01   1 0 0100 0100   1011 111 001   0000 111 011   00 011110 11   0010 0 0 0100 00 10 110   110 111 1 1 01   11 01 101 0   1011 111 001   001 10 100 0 010 000 1 01 10 100   10 0 0001 0 010   110 111 10 10 01   110 00 0001 0   1011 111 001   001 0110   10 0 0001 0 010   110 111 10 10 01   0100 0 1   1011 111 001   100 111 011 10   10 0 0001 0 010   110 111 10 10 01   010 001 10   01 010 111 001 10 100   01 10 100   100 0 000 0 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   11 01 101 0   1011 111 001   1010 010 1011   10 0 0001 0 010   110 111 10 10 01   000 01 1011   110 111 111 100 1000 1011 0   10 0 0001 0 010   110 111 10 10 01   1 0 0100 0100   01   0100 00 0   01 10 100   0000 001 010 1   1011 111 001   011 0 011110 0001 0   101 10 111 011 10   0 01 1010 0000   111 1 0000 0 010   0010 111 010   000 111   0100 111 10 110   1011 111 001 010   0000 0 01 010 1 011110 000   1000 0 0 10   01 1010 0000 00 10 110   1000 001 1   1011 111 001 011110 010 0   1 111 111   000 0000 1011   1 111   000 01 1011   00 1   00 10 000 00 100 0   011 0   1000 111 1 0000   101 10 111 011   011 0000 01 1 011110 000   1000 0 0 10   110 111 00 10 110   111 10   011 0   101 10 111 011   1 0000 0   110 01 11 0   01 10 100   011 0 011110 010 0   110 111 10 10 01   0110 0100 01 1011   00 1   01 10 100   00 0010   1011 111 001   01 000 101   11 0   0000 111 011   00 011110 11   0010 0 0 0100 00 10 110   100 111 10 011110 1   1 0 0100 0100   11 0   1011 111 001 011110 010 0   1 111 111   1000 0100 00 10 100   1 111   000 0 0   10 0 0001 0 010   110 111 10 10 01   110 00 0001 0   1011 111 001   001 0110   10 0 0001 0 010   110 111 10 10 01   0100 0 1   1011 111 001   100 111 011 10   10 0 0001 0 010   110 111 10 10 01   010 001 10   01 010 111 001 10 100   01 10 100   100 0 000 0 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   11 01 101 0   1011 111 001   1010 010 1011   10 0 0001 0 010   110 111 10 10 01   000 01 1011   110 111 111 100 1000 1011 0   10 0 0001 0 010   110 111 10 10 01   1 0 0100 0100   01   0100 00 0   01 10 100   0000 001 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   110 00 0001 0   1011 111 001   001 0110   10 0 0001 0 010   110 111 10 10 01   0100 0 1   1011 111 001   100 111 011 10   10 0 0001 0 010   110 111 10 10 01   010 001 10   01 010 111 001 10 100   01 10 100   100 0 000 0 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   11 01 101 0   1011 111 001   1010 010 1011   10 0 0001 0 010   110 111 10 10 01   000 01 1011   110 111 111 100 1000 1011 0   10 0 0001 0 010   110 111 10 10 01   1 0 0100 0100   01   0100 00 0   01 10 100   0000 001 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   110 00 0001 0 110011   10 0 0001 0 010   110 111 10 10 01   110 00 0001 0   011 0 011110 0001 0   101 10 111 011 10   0 01 1010 0000   111 1 0000 0 010   0010 111 010   000 111   0100 111 10 110   1011 111 001 010   0000 0 01 010 1 011110 000   1000 0 0 10   01 1010 0000 00 10 110   1000 001 1   1011 111 001 011110 010 0   1 111 111   000 0000 1011   1 111   000 01 1011   00 1   00 10 000 00 100 0   011 0   1000 111 1 0000   101 10 111 011   011 0000 01 1 011110 000   1000 0 0 10   110 111 00 10 110   111 10   011 0   101 10 111 011   1 0000 0   110 01 11 0   01 10 100   011 0 011110 010 0   110 111 10 10 01   0110 0100 01 1011   00 1   00   0111 001 000 1   011 01 10 10 01   1 0 0100 0100   1011 111 001   0000 111 011   00 011110 11   0010 0 0 0100 00 10 110   110 111 1 1 01   11 01 101 0   1011 111 001   001 10 100 0 010 000 1 01 10 100   10 0 0001 0 010   110 111 10 10 01   110 00 0001 0   1011 111 001   001 0110   10 0 0001 0 010   110 111 10 10 01   0100 0 1   1011 111 001   100 111 011 10   10 0 0001 0 010   110 111 10 10 01   010 001 10   01 010 111 001 10 100   01 10 100   100 0 000 0 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   11 01 101 0   1011 111 001   1010 010 1011   10 0 0001 0 010   110 111 10 10 01   000 01 1011   110 111 111 100 1000 1011 0   10 0 0001 0 010   110 111 10 10 01   1 0 0100 0100   01   0100 00 0   01 10 100   0000 001 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   110 00 0001 0   1011 111 001   001 0110   10 0 0001 0 010   110 111 10 10 01   0100 0 1   1011 111 001   100 111 011 10   10 0 0001 0 010   110 111 10 10 01   010 001 10   01 010 111 001 10 100   01 10 100   100 0 000 0 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   11 01 101 0   1011 111 001   1010 010 1011   10 0 0001 0 010   110 111 10 10 01   000 01 1011   110 111 111 100 1000 1011 0   10 0 0001 0 010   110 111 10 10 01   1 0 0100 0100   01   0100 00 0   01 10 100   0000 001 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   110 00 0001 0   1011 111 001   001 0110   10 0 0001 0 010   110 111 10 10 01   0100 0 1   1011 111 001   100 111 011 10   10 0 0001 0 010   110 111 10 10 01   010 001 10   01 010 111 001 10 100   01 10 100   100 0 000 0 010 1   1011 111 001   10 0 0001 0 010   110 111 10 10 01   11 01 101 0   1011 111 001   1010 010 1011   10 0 0001 0 010   110 111 10 10 01   000 01 1011   110 111 111 100 1000 1011 0"
const chooseBG = Math.random() > 0.05;
const distx = 80;
const disty = 100;
let nRows = Math.ceil(window.innerHeight / distx) + 1;
let nCols = Math.ceil(window.innerWidth / disty) + 1;
let cvs = document.getElementById("qfux");
let b = document.getElementById("DWQo");
let ctx = cvs.getContext("2d");
let mX = window.innerWidth * 0.5;
let mY = window.innerHeight * 0.5;
let size, radius, xCoord, yCoord, dots;

class Dot {
    constructor(xCoord, yCoord) {
        this.xCoord = xCoord;
        this.yCoord = yCoord;
        this.neighbors = new Array();
        this.visible = Math.random() > 0.3;
    }

    addNeighbor(n) {
        this.neighbors.push(n);
    }

    draw() {
        if (this.visible) {
            ctx.fillStyle = calculateOpacity(this.xCoord, this.yCoord, 0.04, 0.25);
            ctx.beginPath();
            ctx.arc(this.xCoord, this.yCoord, radius, 0, 2 * Math.PI);
            ctx.fill();
            for (let i = 0; i < this.neighbors.length; i++) {
                if (this.neighbors[i].visible) {
                    ctx.strokeStyle = calculateOpacity((this.xCoord + this.neighbors[i].xCoord) / 2, (this.yCoord + this.neighbors[i].yCoord) / 2, 0.04, 0.25);
                    ctx.lineWidth = 0.5 * radius;
                    ctx.beginPath();
                    ctx.moveTo(this.xCoord, this.yCoord);
                    ctx.lineTo(this.neighbors[i].xCoord, this.neighbors[i].yCoord);
                    ctx.stroke();
                }
            }

        }
    }
}

CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
    x = x + 0.2 * size;
    y = y + 0.3 * size;
    w = w - 0.2 * size;
    h = h - 0.3 * size;
    if (w < 2 * r) r = w / 2;
    if (h < 2 * r) r = h / 2;
    this.beginPath();
    this.moveTo(x + r, y);
    this.arcTo(x + w, y, x + w, y + h, r);
    this.arcTo(x + w, y + h, x, y + h, r);
    this.arcTo(x, y + h, x, y, r);
    this.arcTo(x, y, x + w, y, r);
    this.closePath();
    return this;
}

function calculateOpacity(x, y, offset = 0.01, magnificattion = 0.1) {
    d = Math.sqrt(
        Math.pow(x - mX, 2) + Math.pow(y - mY, 2)
    );
    maxd = Math.min(0.5 * window.innerHeight, 0.5 * window.innerWidth);
    if (d - maxd > 0) {
        op = offset;
    }
    else {
        op = ((maxd - d) / maxd) * magnificattion + offset;
    }
    return "rgba(255,255,255," + op + ")";
}

function drawMorse() {
    for (let i = 0; i < code.length; i++) {
        if (code[i] === "0") {
            // Square
            if (xCoord + size > window.innerWidth) {
                xCoord = 0;
                yCoord += size;
            }
            ctx.fillStyle = calculateOpacity(xCoord + size, yCoord, 0.025, 0.3);
            rect = ctx.roundRect(xCoord, yCoord, size, size, 0.15 * size).fill();
            xCoord += size;
        }
        else if (code[i] === "1") {
            // Rectangle
            if (xCoord + (3 * size) > window.innerWidth) {
                xCoord = 0;
                yCoord += size;
            }
            ctx.fillStyle = calculateOpacity(xCoord + size, yCoord, 0.025, 0.3);
            rect = ctx.roundRect(xCoord, yCoord, 3 * size, size, 0.15 * size).fill();
            xCoord += 3 * size;
        }
        else {
            // Space
            if (xCoord + (2 * size) > window.innerWidth) {
                xCoord = 0;
                yCoord += size;
            }
            xCoord += 2 * size;
        }
    }
}

function drawHex() {
    dots.forEach(row => {
        row.forEach(dot => {
            dot.draw();
        });
    });
}

function setBackground() {
    cvs.height = window.innerHeight;
    cvs.width = window.innerWidth;
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    size = 0.02 * Math.min(window.innerHeight, window.innerWidth);
    radius = 0.25 * size;
    xCoord = 0;
    yCoord = 0;
    chooseBG ? drawHex() : drawMorse();
}

function createDotArray() {
    dots = new Array();
    for (let i = 0; i < nCols; i++) {
        dots.push([]);
        for (let j = 0; j < nRows; j++) {
            dots[i].push(new Dot(i * disty + (j % 2) * (disty / 2), j * distx));
        }
    }
    for (let i = 0; i < nCols; i++) {
        for (let j = 0; j < nRows; j++) {
            if (i > 0 && j > 0) {
                dots[i][j].addNeighbor(dots[i - 1][j]);
            }
            if (j > 0) {
                dots[i][j].addNeighbor(dots[i][j - 1]);
            }
            if (i > 0 && j < nRows - 1) {
                if (j % 2 == 0) {
                    dots[i][j].addNeighbor(dots[i - 1][j + 1]);
                }
                else if (i < nCols - 1) {
                    dots[i][j].addNeighbor(dots[i + 1][j + 1]);
                }
            }
        }
    }
}

b.onmousemove = function () {
    mX = event.clientX;
    mY = event.clientY;
}


if (chooseBG) {
    createDotArray();
}

setBackground();
setInterval(setBackground, 30);